import React, { useState, useEffect } from 'react';
import { Plus, Minus, RotateCcw, History, X } from 'lucide-react';

const App = () => {
  const [count, setCount] = useState(0);
  const [isPressed, setIsPressed] = useState(null);
  const [history, setHistory] = useState([]);
  const [showHistory, setShowHistory] = useState(false);

  // Sound effect simulation (visual feedback is primary, but structure is here)
  const triggerHaptic = () => {
    if (navigator.vibrate) {
      navigator.vibrate(5); // Light vibration for mobile
    }
  };

  const handleIncrement = () => {
    setCount(c => c + 1);
    triggerHaptic();
    addToHistory('increment', count + 1);
  };

  const handleDecrement = () => {
    setCount(c => c - 1);
    triggerHaptic();
    addToHistory('decrement', count - 1);
  };

  const handleReset = () => {
    if (count !== 0) {
      setCount(0);
      triggerHaptic();
      addToHistory('reset', 0);
    }
  };

  const addToHistory = (action, value) => {
    const newEntry = {
      id: Date.now(),
      action,
      value,
      time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' })
    };
    setHistory(prev => [newEntry, ...prev].slice(0, 20));
  };

  // Background distinct "blobs" for that iOS wallpaper feel
  return (
    <div className="min-h-screen bg-[#F2F2F7] flex items-center justify-center font-sans overflow-hidden relative selection:bg-blue-200 selection:text-blue-900">
      
      {/* Background Gradients/Blobs */}
      <div className="absolute top-[-10%] left-[-10%] w-96 h-96 bg-blue-400/30 rounded-full blur-3xl animate-pulse" style={{ animationDuration: '8s' }} />
      <div className="absolute bottom-[-10%] right-[-10%] w-96 h-96 bg-indigo-400/30 rounded-full blur-3xl animate-pulse" style={{ animationDuration: '10s' }} />
      <div className="absolute top-[40%] left-[40%] w-72 h-72 bg-purple-300/20 rounded-full blur-3xl animate-pulse" style={{ animationDuration: '12s' }} />

      {/* Main Card Container */}
      <div className="relative w-full max-w-sm mx-4">
        
        {/* The "Device" or Card */}
        <div className="bg-white/60 backdrop-blur-xl border border-white/40 shadow-[0_25px_50px_-12px_rgba(0,0,0,0.15)] rounded-[2.5rem] overflow-hidden transition-all duration-300">
          
          {/* Header */}
          <div className="px-6 pt-6 flex justify-between items-center">
            <h1 className="text-sm font-semibold tracking-wide text-slate-500 uppercase">Counter</h1>
            <button 
              onClick={() => setShowHistory(true)}
              className="p-2 rounded-full hover:bg-black/5 text-slate-500 transition-colors"
            >
              <History size={20} />
            </button>
          </div>

          {/* Display Area */}
          <div className="h-64 flex flex-col items-center justify-center relative">
             {/* Animated Number Display */}
             <div className="relative">
                <span 
                  key={count} // Key change triggers animation
                  className="text-8xl font-light text-slate-800 tracking-tighter animate-in slide-in-from-bottom-2 fade-in duration-300"
                  style={{ fontVariantNumeric: 'tabular-nums' }}
                >
                  {count}
                </span>
             </div>
             <p className="text-slate-400 text-sm font-medium mt-2">Total Clicks</p>
          </div>

          {/* Controls Area */}
          <div className="bg-white/50 backdrop-blur-md p-6 border-t border-white/50">
            <div className="flex items-center justify-between gap-4">
              
              {/* Decrement Button */}
              <button
                onClick={handleDecrement}
                onMouseDown={() => setIsPressed('minus')}
                onMouseUp={() => setIsPressed(null)}
                onMouseLeave={() => setIsPressed(null)}
                className={`
                  w-16 h-16 rounded-full flex items-center justify-center
                  bg-white shadow-sm border border-slate-100
                  text-slate-400 hover:text-slate-600 hover:bg-slate-50
                  transition-all duration-200 ease-spring
                  ${isPressed === 'minus' ? 'scale-90 bg-slate-100' : 'scale-100'}
                `}
              >
                <Minus size={28} strokeWidth={2.5} />
              </button>

              {/* Reset Button */}
              <button
                onClick={handleReset}
                onMouseDown={() => setIsPressed('reset')}
                onMouseUp={() => setIsPressed(null)}
                onMouseLeave={() => setIsPressed(null)}
                className={`
                  w-14 h-14 rounded-full flex items-center justify-center
                  text-slate-400 hover:text-red-500 hover:bg-red-50
                  transition-all duration-200 ease-spring
                  ${isPressed === 'reset' ? 'scale-90 bg-red-100 text-red-500' : 'scale-100'}
                `}
              >
                <RotateCcw size={24} strokeWidth={2.5} />
              </button>

              {/* Increment Button (Primary) */}
              <button
                onClick={handleIncrement}
                onMouseDown={() => setIsPressed('plus')}
                onMouseUp={() => setIsPressed(null)}
                onMouseLeave={() => setIsPressed(null)}
                className={`
                  w-24 h-24 rounded-[2rem] flex items-center justify-center
                  bg-blue-500 shadow-lg shadow-blue-500/30
                  text-white
                  transition-all duration-200 ease-[cubic-bezier(0.34,1.56,0.64,1)]
                  ${isPressed === 'plus' ? 'scale-90 shadow-sm bg-blue-600' : 'hover:-translate-y-1 hover:shadow-xl scale-100'}
                `}
              >
                <Plus size={40} strokeWidth={3} />
              </button>
            </div>
          </div>
        </div>
      </div>

      {/* History Modal / Sheet */}
      {showHistory && (
        <div className="absolute inset-0 z-50 flex items-end justify-center sm:items-center p-4 bg-black/20 backdrop-blur-sm transition-opacity duration-300">
           <div className="w-full max-w-sm bg-white/90 backdrop-blur-2xl rounded-[2rem] shadow-2xl overflow-hidden max-h-[80vh] animate-in slide-in-from-bottom-10 duration-300">
              <div className="p-5 border-b border-slate-200/60 flex justify-between items-center">
                <h2 className="font-semibold text-lg text-slate-800">History</h2>
                <button 
                  onClick={() => setShowHistory(false)}
                  className="p-2 bg-slate-100 rounded-full text-slate-500 hover:bg-slate-200"
                >
                  <X size={18} />
                </button>
              </div>
              <div className="overflow-y-auto max-h-[50vh] p-4 space-y-2">
                {history.length === 0 ? (
                  <div className="text-center py-8 text-slate-400">No history yet</div>
                ) : (
                  history.map((item) => (
                    <div key={item.id} className="flex justify-between items-center p-3 bg-white rounded-xl border border-slate-100 shadow-sm">
                      <div className="flex items-center gap-3">
                        <div className={`w-2 h-2 rounded-full ${
                          item.action === 'increment' ? 'bg-blue-500' : 
                          item.action === 'decrement' ? 'bg-orange-400' : 'bg-slate-400'
                        }`} />
                        <span className="text-sm font-medium capitalize text-slate-600">{item.action}</span>
                      </div>
                      <div className="flex items-center gap-4">
                         <span className="text-xs text-slate-400 font-mono">{item.time}</span>
                         <span className="text-sm font-bold text-slate-800 w-8 text-right">{item.value}</span>
                      </div>
                    </div>
                  ))
                )}
              </div>
           </div>
        </div>
      )}

      <style jsx global>{`
        @keyframes spring {
          0% { transform: scale(1); }
          50% { transform: scale(0.95); }
          100% { transform: scale(1); }
        }
        .ease-spring {
          transition-timing-function: cubic-bezier(0.34, 1.56, 0.64, 1);
        }
      `}</style>
    </div>
  );
};

export default App;